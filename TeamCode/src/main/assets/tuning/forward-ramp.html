<!doctype html>
<html>
  <head>
    <title>RR Forward Ramp Regression</title>

    <style>
body {
  font-family: Arial, Helvetica, sans-serif;
}

.content {
  max-width: 600px;
  margin: auto;
}

.bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
    </style>

    <script src="/tuning/plotly-2.12.1.min.js"></script>

    <!-- https://tom-alexander.github.io/regression-js/ -->
    <script src="/tuning/regression-2.0.1.min.js"></script>

    <!-- <script src="/tuning/common.js"></script> -->
    <script src="common.js"></script>
  </head>
  <body>
    <div class="content">
      <h1>RR Forward Ramp Regression</h1>
      <p></p> 
      
      <div id="rampChart">Loading...</div>
    </div>

    <script>
const rampChartDiv = document.getElementById('rampChart');
fetch('/tuning/forward-ramp/latest.json')
  .then(res => {
    if (res.ok) {
      return res.json();
    } else {
      rampChartDiv.innerText = 'No data files found';
      throw new Error();
    }
  })
  .then(data => {
    const forwardEncVels = data.forwardEncVels.flatMap((vs, i) => 
      fixVels(data.encTimes, data.forwardEncPositions[i], vs));
    const appliedVoltages = data.forwardEncVels.flatMap(vs =>
      data.voltages.map((v, i) => 
        data.powers.reduce((acc, ps) => Math.max(acc, ps[i]), 0) * v));

    newLinearRegressionChart(
      rampChartDiv,
      forwardEncVels, appliedVoltages,
      {title: 'Ramp Regression', slope: 'kV', intercept: 'kS'}
    );
  })
  .catch(console.log.bind(console));
    </script>
  </body>
</html>
